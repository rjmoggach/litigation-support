# Requirements Document

## Introduction

This specification addresses the systematic replacement of 22 manual fetch calls across 8 frontend files with autogenerated API client calls. The project aims to eliminate technical debt by leveraging the existing `@hey-api/openapi-ts` infrastructure that generates comprehensive TypeScript SDK with 200+ API functions. This replacement will improve type safety, standardize error handling, and reduce maintenance overhead while ensuring all API interactions follow consistent patterns.

## Alignment with Product Vision

This feature directly supports the product vision by:
- **Improving Reliability**: Replacing error-prone manual fetch calls with type-safe, validated API clients reduces bugs that could disrupt self-represented litigants during critical evidence collection
- **Enhancing Developer Productivity**: Standardized API patterns accelerate development of new litigation support features
- **Ensuring Data Integrity**: Type-safe API calls prevent data corruption that could compromise legal document accuracy
- **Supporting Scalability**: Consistent API architecture enables reliable expansion of litigation support capabilities

## Requirements

### Requirement 1: Replace Manual Fetch Calls in Profile Management

**User Story:** As a developer maintaining the litigation support system, I want all profile management API calls to use the autogenerated client, so that profile operations are type-safe and consistently handled across the application.

#### Acceptance Criteria

1. WHEN profile forms make API calls THEN the system SHALL use autogenerated API functions instead of manual fetch calls
2. WHEN profile data is updated THEN the system SHALL use typed request/response objects from the generated SDK
3. WHEN API errors occur during profile operations THEN the system SHALL handle them using the standardized error handling patterns from the autogenerated client
4. WHEN `profile-form-original.tsx` is refactored THEN it SHALL replace all 13 manual fetch calls with their autogenerated equivalents

### Requirement 2: Standardize Authentication Layer API Calls

**User Story:** As a developer working on authentication features, I want all authentication API calls to use the autogenerated client, so that authentication flows are consistent and benefit from automatic type validation.

#### Acceptance Criteria

1. WHEN users authenticate THEN the system SHALL use autogenerated authentication API functions
2. WHEN token refresh occurs THEN the system SHALL use the generated token refresh endpoint
3. WHEN users log out THEN the system SHALL use the autogenerated logout API function
4. WHEN OAuth flows execute THEN they SHALL replace manual fetch calls in `auth.ts` (5 calls), `token-refresh.ts`, `logout.ts`, and `oauth-utils.ts`

### Requirement 3: Convert Gallery and Media Operations

**User Story:** As a developer implementing media management features for legal evidence, I want gallery operations to use the autogenerated client, so that document and image handling is type-safe and reliable.

#### Acceptance Criteria

1. WHEN gallery data is loaded THEN the system SHALL use autogenerated gallery API functions
2. WHEN media files are processed THEN the system SHALL use typed media operation endpoints
3. WHEN `gallery-table.tsx` makes API calls THEN it SHALL use the generated client instead of 2 manual fetch calls

### Requirement 4: Maintain Backward Compatibility During Migration

**User Story:** As a system administrator, I want the API migration to occur without breaking existing functionality, so that self-represented litigants can continue using the system uninterrupted during the transition.

#### Acceptance Criteria

1. WHEN manual fetch calls are replaced THEN existing functionality SHALL remain identical
2. WHEN autogenerated clients are implemented THEN they SHALL maintain the same request/response behavior as manual calls
3. WHEN migration is in progress THEN both old and new patterns MAY coexist temporarily without conflicts
4. WHEN the migration is complete THEN no manual fetch calls SHALL remain in the identified files

## Non-Functional Requirements

### Code Architecture and Modularity
- **Single Responsibility Principle**: Each API call replacement should focus solely on migrating one specific endpoint without modifying unrelated functionality
- **Modular Design**: Utilize existing autogenerated API client modules without creating custom abstractions
- **Dependency Management**: Leverage the existing `@hey-api/openapi-ts` dependency without introducing additional HTTP client libraries
- **Clear Interfaces**: Maintain existing component interfaces while internally switching to autogenerated API calls

### Performance
- **Response Time**: API call performance must remain equivalent or improve compared to manual fetch implementations
- **Bundle Size**: Replacement should not significantly increase client bundle size beyond the already-included autogenerated client
- **Memory Usage**: Generated API clients should not consume more memory than existing manual fetch patterns

### Security
- **Authentication**: All replaced API calls must maintain existing authentication token handling through the autogenerated client
- **Data Validation**: Type-safe API calls must validate request/response data automatically through the generated schemas
- **Error Handling**: Standardized error handling must not expose sensitive information in client-side error messages

### Reliability
- **Error Recovery**: Autogenerated API calls must provide equivalent or better error recovery compared to manual fetch implementations
- **Network Resilience**: API client should handle network failures gracefully with appropriate retry mechanisms where applicable
- **Type Safety**: All API interactions must be fully type-checked to prevent runtime errors

### Usability
- **Developer Experience**: Replaced API calls should provide better autocomplete, documentation, and debugging capabilities through TypeScript integration
- **Maintenance**: Code using autogenerated clients should require less maintenance and be more resistant to API changes
- **Debugging**: Generated API calls should provide clear error messages and request/response logging capabilities